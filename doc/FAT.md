**FAT12是FAT文件系统的一个版本**，主要用于小容量的存储介质，如早期的软盘。以下是FAT12文件系统的主要结构和组件的位置：

1. **引导扇区（Boot Sector）**:
   - 位置：文件系统的第一个扇区。
   - 功能：包含文件系统的基本参数、启动代码和其他重要信息。这些信息用于操作系统识别和挂载文件系统。

2. **FAT表**:
   - 位置：紧随引导扇区之后。
   - 功能：文件分配表，用于跟踪文件数据块（簇）的使用情况。在FAT12中，每个表项占用12位(1.5字节)。
   - 注意：FAT12文件系统通常有两个FAT表的副本，作为冗余。第二个FAT表紧随第一个FAT表。
   - 每个FAT表大约占用9个扇区。由于FAT12通常有两个FAT表，所以总共需要18个扇区来存储FAT表。
   
3. **根目录**:
   - 位置：紧随两个FAT表之后。
   - 功能：存储文件和子目录的目录项。在FAT12和FAT16中，根目录的大小和位置是固定的。
   - 注意：根目录可以容纳的目录项数量是固定的。例如，对于1.44MB的软盘，通常可以容纳224个目录项。
   - 根目录在FAT文件系统中用于存储文件和子目录的元数据。每个文件或子目录在根目录中都有一个对应的目录项，这个目录项包含了文件或目录的元数据
   
4. **数据区**:
   - 位置：紧随根目录之后，直到文件系统的末尾。
   - 功能：存储文件和非根目录的数据。数据区被划分为大小固定的簇，每个簇包含一个或多个扇区。
   - 注意：数据区的第一个簇（簇号为2）是文件系统中的第一个数据簇。簇号0和1是保留的，不用于数据存储。

这就是FAT12文件系统的基本结构。引导扇区、FAT表、根目录和数据区是其主要组成部分，它们按照固定的顺序在存储介质上连续排列。





## 使用dd命令把boot.bin写入到boot.img 过程相当于格式化过程，把文件系统的数据结构写入到磁盘



**当把文件cp到FAT12文件系统的磁盘里的时候：**

* **文件的元数据（如文件名、大小等）会被添加到根目录中的一个目录项中。**
* **文件的实际二进制数据会被写入到数据区的一个或多个簇中。**
* **FAT表会更新，以跟踪这些簇的使用情况。**





**根目录用于存储目录项，然后通过目录项来表示元数据**

**元数据信息：**

* 文件名和扩展名：通常为8.3格式，即最多8个字符的文件名和3个字符的扩展名。
* 文件属性：如只读、隐藏、系统文件、目录、存档等。
* 时间戳：包括文件的创建时间、最后访问时间和最后修改时间。
* 文件大小：表示文件的字节数。
* 文件的第一个簇的位置：这个值指向数据区中文件数据的开始位置。



在FAT12文件系统中，每个目录项都占用32字节。这32字节的内容包含了文件或目录的元数据。以下是这32字节的详细分布和含义：

1. **文件名** (0-7字节，共8字节)：存储文件或目录的名称。如果文件名长度少于8个字符，它会被空格填充。

2. **文件扩展名** (8-10字节，共3字节)：存储文件的扩展名。同样，如果扩展名长度少于3个字符，它会被空格填充。

3. **文件属性** (11字节)：一个字节，表示文件的属性，如只读、隐藏、系统文件、目录、存档等。

4. **保留** (12-13字节，共2字节)：为将来使用而保留。

5. **创建时间** (14-15字节，共2字节)：文件的创建时间。

6. **创建日期** (16-17字节，共2字节)：文件的创建日期。

7. **最后访问日期** (18-19字节，共2字节)：文件最后被访问的日期。

8. **保留** (20-21字节，共2字节)：为将来使用而保留。

9. **最后修改时间** (22-23字节，共2字节)：文件最后修改的时间。

10. **最后修改日期** (24-25字节，共2字节)：文件最后修改的日期。

11. **起始簇号** (26-27字节，共2字节)：文件数据的起始簇号。这是在FAT表中查找文件数据的起点。

12. **文件大小** (28-31字节，共4字节)：文件的大小，以字节为单位。对于目录，这个字段通常设置为0。

这32字节的结构为FAT12文件系统提供了文件和目录的基本信息，使得操作系统和应用程序能够正确地定位、读取和写入文件数据。



起始簇号：

* 这是一个16位的值（占用2字节），表示文件或目录的第一个数据簇在数据区域的位置。
* 它是一个相对值，表示从数据区域开始的簇的偏移量。
* 使用这个起始簇号，可以在FAT表中查找文件或目录的实际数据位置。FAT表中的条目提供了文件数据簇的链式结构，指示数据在哪里开始和结束，以及如何跟踪文件的连续部分（如果文件跨越多个簇）



为什么要从2开始编号呢？

* 簇号0在FAT中是保留的，通常用于表示磁盘上的坏簇。
* 簇号1在FAT12和FAT16中也是保留的，用于存储一些特殊的信息。
* 因此，实际的文件数据存储从簇号2开始。





FAT12文件系统中的FAT（File Allocation Table）是一个关键组件，用于跟踪文件数据在磁盘上的位置。FAT表中的每个条目都是一个12位的值，因此得名FAT12。

**FAT12的FAT表项的特点**：

1. **大小**：每个FAT表项占用12位。由于字节是8位的，这意味着FAT12的FAT表项会跨越字节边界。例如，三个连续的FAT表项可能会使用两个字节，然后使用下一个字节的前四位，然后使用下一个字节的全部，依此类推。

2. **链式结构**：FAT表项为文件数据提供了链式结构。每个条目指向文件数据的下一个簇，或者包含一个特殊的结束标记（通常是`0xFFF`）来表示文件的结束。

3. **特殊值**：
   - `0x000`：表示该簇未被使用。
   - `0xFF0`到`0xFF6`：保留值。
   - `0xFF7`：表示坏簇，即该簇不可用。
   - `0xFF8`到`0xFFF`：表示文件或目录的最后一个簇。

4. **位置**：FAT表紧跟在引导扇区之后。通常，FAT12文件系统会有两个FAT表的副本，以增加可靠性。如果第一个FAT表损坏，系统可以使用第二个FAT表。

5. **文件分散**：由于文件可以在磁盘上分散存储，FAT表提供了一种方法来跟踪文件的各个部分。例如，一个文件的第一个部分可能在簇5，第二个部分在簇8，第三个部分在簇10。FAT表中的条目将确保这些簇被正确地链接在一起，以表示完整的文件。

6. **动态更新**：当文件被写入、删除或修改时，FAT表会相应地更新。当新文件被写入或现有文件被扩展时，新的簇会被分配，并在FAT表中更新。当文件被删除时，其相关的FAT表项会被标记为未使用。

总的来说，FAT12的FAT表是文件系统中的核心组件，负责跟踪文件数据在磁盘上的位置。它提供了一种链式结构，使得文件可以在磁盘上分散存储，同时仍然可以被正确地访问和读取。





当你将文件移动到FAT12文件系统并尝试访问它时，以下是操作系统和文件系统进行的基本步骤，以及与表项和目录项的关系：

1. **查找目录项**：
   - 首先，操作系统会在根目录（或其他适当的子目录）中查找文件的目录项。目录项包含文件的基本元数据，如文件名、扩展名、属性、文件大小等。
   - 目录项中的关键字段是“起始簇号”，它指示文件数据在数据区开始的位置。

2. **访问FAT表**：
   - 使用目录项中的起始簇号，操作系统会查找FAT表以确定文件数据的实际位置。
   - FAT表中的条目提供了文件数据簇的链式结构。每个条目都指向文件的下一个簇，或者包含一个特殊的结束标记来表示文件的结束。

3. **读取文件数据**：
   - 一旦确定了文件数据的位置，操作系统就可以从数据区读取文件的实际内容。
   - 如果文件跨越多个簇，操作系统会使用FAT表中的链式结构来跟踪并读取文件的所有部分。

4. **关系**：
   - **目录项**：提供文件的元数据和起始簇号，这是查找文件数据的起点。
   - **FAT表项**：提供文件数据在磁盘上的链式结构。它告诉操作系统文件的各个部分在哪里，以及如何链接这些部分以读取完整的文件。

总的来说，当你访问FAT12文件系统中的文件时，操作系统首先使用目录项来获取文件的基本信息和起始簇号，然后使用FAT表来跟踪文件的实际数据位置。这两个组件共同确保了文件可以被正确地访问和读取，即使文件在磁盘上是分散存储的。





你提到了一个很好的点。确实，FAT12文件系统中的每个FAT表项只有12位，但这12位足以表示簇的编号。这是因为FAT12通常用于较小的存储介质，如软盘，其中簇的总数不会超过2^12（即4096）个。

以下是FAT12中链式结构的工作方式：

1. **簇编号**：每个FAT表项的12位值表示一个簇的编号。这个编号指向数据区中的一个特定簇。

2. **链式结构**：
   - 当一个文件被存储在多个簇中时，它的第一个簇的FAT表项将包含第二个簇的编号。
   - 第二个簇的FAT表项将包含第三个簇的编号，依此类推。
   - 当到达文件的最后一个簇时，该簇的FAT表项将包含一个特殊的结束标记（在FAT12中通常是`0xFFF`），表示文件的结束。

3. **示例**：
   - 假设一个文件开始于簇5，并继续存储在簇8和簇10。
   - 在FAT表中，簇5的条目将包含值8，表示下一个簇是簇8。
   - 簇8的条目将包含值10，表示下一个簇是簇10。
   - 簇10的条目将包含结束标记，表示文件的结束。

因此，尽管每个FAT表项只有12位，但这足以为文件数据提供链式结构，指示文件的各个部分在数据区的位置。这种设计使FAT12能够有效地管理较小的存储介质，如软盘。